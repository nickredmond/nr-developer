var isQuizNameValid = true;
var questions = [];
var currentQuestionNum = 1;

function onQuizNameInput(quizName) {
	isQuizNameValid = !quizName.match(INVALID_NAME_PATTERN);
	document.getElementById("invalid-name-alert").style.display = isQuizNameValid ?
		"none" :
		"block";
}

function isStringNullOrEmpty(value) {
	return (!value || value.trim() === "");
}
function getQuestionText() {
	return document.getElementById("question-text-input").value;
}
function getResponseInputs() {
	var responses = [];
	isResponsesEntered = true;
	for (var i = 1; i <= POSSIBLE_RESPONSES_COUNT && isResponsesEntered; i++) {
		var responseValue = document.getElementById("response-" + i + "-input").value;
		if (isStringNullOrEmpty(responseValue)) {
			isResponsesEntered = false;
			responses = [];
		}
		else { 
			responses.push(responseValue);
		}
	}
	return responses;
}
function getCorrectResponseIndex() {
	var selectedButton = document.querySelector("input[name='correct-response']:checked");
	var buttons = document.querySelectorAll("input[name='correct-response']");
	var buttonsArray = Array.from(buttons);
	return selectedButton ? buttonsArray.indexOf(selectedButton) : -1;
}
function verifyCurrentQuestion() {
	var isComplete = true;

	if (isStringNullOrEmpty(getQuestionText())) {
		isComplete = false;
		document.getElementById("blank-question-text-alert").style.display = "block";
	}
	if (getResponseInputs().length === 0) {
		isComplete = false;
		document.getElementById("blank-responses-alert").style.display = "block";
	}
	if (getCorrectResponseIndex() < 0) {
		isComplete = false;
		document.getElementById("blank-correct-response-alert").style.display = "block";
	}

	return isComplete;
}

function clearQuestionInputs() {
	document.getElementById("question-text-input").value = "";
	for (var i = 1; i <= POSSIBLE_RESPONSES_COUNT; i++) {
		document.getElementById("response-" + i + "-input").value = "";
	}

	var checkedOption = document.querySelector("input[name='correct-response']:checked");
	if (checkedOption) {
		checkedOption.checked = false;
	}
}

function refreshView() {
	document.getElementById("blank-question-text-alert").style.display = "none";
	document.getElementById("blank-responses-alert").style.display = "none";
	document.getElementById("blank-correct-response-alert").style.display = "none";

	window.scrollTo(0, 0);
}

function setQuestionTitle () {
	document.getElementById("question-title").innerHTML = "Question #" + currentQuestionNum;
}

function onDeleteQuizClick() {
	refreshView();
}
function onDeleteQuestionClick() {
	refreshView();

	if (currentQuestionNum > 1) {
		var lastQuestion = questions.pop();
		currentQuestionNum -= 1;
		setQuestionTitle();
		document.getElementById("question-text-input").value = lastQuestion["question-text"];
		for (var i = 1; i <= POSSIBLE_RESPONSES_COUNT; i++) {
			document.getElementById("response-" + i + "-input").value = lastQuestion["responses"][i - 1];
		}

		var optNumber = lastQuestion["correct-response-index"] + 1;
		var checkedOption = document.querySelector("input[name='correct-response']:checked");
		if (checkedOption) {
			checkedOption.checked = false;
		}
		document.getElementById("correct-opt-" + optNumber).checked = true;
	}
}
function onAddQuestionClick() {
	refreshView();

	if (verifyCurrentQuestion()) {
		var question = {
			"question-id": currentQuestionNum,
			"question-text": getQuestionText(),
			"responses": getResponseInputs(),
			"correct-response-index": getCorrectResponseIndex()
		};
		questions.push(question);
		currentQuestionNum += 1;
		setQuestionTitle();
		clearQuestionInputs();
	}
}
function onPublishQuizClick() {
	refreshView();
}
